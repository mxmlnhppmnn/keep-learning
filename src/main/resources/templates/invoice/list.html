<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      layout:decorate="~{layout}">

<main layout:fragment="content">

    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1 class="mb-0">Rechnungen</h1>
    </div>

    <div th:if="${param.created}" class="alert alert-success">
        Rechnung wurde erstellt.
    </div>

    <h3 class="mt-4">Kurse</h3>

    <div th:if="${#lists.isEmpty(series)}" class="alert alert-info">
        Du hast noch keine Kurse gebucht.
    </div>

    <div class="card" th:if="${!#lists.isEmpty(series)}">
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped align-middle mb-0">
                    <thead>
                    <tr>
                        <th>Kurs</th>
                        <th>Fach</th>
                        <th>Zahlung</th>
                        <th></th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="s : ${series}">
                        <td th:text="${@invoiceService.courseTitle(s)}"></td>
                        <td th:text="${@invoiceService.subjectName(s)}"></td>
                        <td>
                            <span th:text="${s.paid} ? 'bezahlt' : (s.trialLesson ? 'Probestunde' : 'unbezahlt')"></span>
                        </td>
                        <td class="text-end">
                            <form th:action="@{/rechnungen/create}" method="post" class="d-inline">
                                <input type="hidden" name="seriesId" th:value="${s.id}" />
                                <button class="btn btn-primary btn-sm" type="submit">Rechnung erstellen</button>
                            </form>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <h3 class="mt-4">Erstellte Rechnungen</h3>

    <div th:if="${#lists.isEmpty(invoices)}" class="alert alert-info">
        Noch keine Rechnungen vorhanden.
    </div>

    <div class="card" th:if="${!#lists.isEmpty(invoices)}">
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped align-middle mb-0">
                    <thead>
                    <tr>
                        <th>Erstellt am</th>
                        <th>Summe</th>
                        <th>Datei</th>
                        <th></th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="inv : ${invoices}">
                        <td th:text="${#temporals.format(inv.createdAt, 'dd.MM.yyyy HH:mm')}"></td>
                        <td th:text="${#numbers.formatDecimal(inv.totalAmount,1,2)} + ' EUR'"></td>
                        <td th:text="${inv.filename}"></td>
                        <td class="text-end">
                            <a class="btn btn-outline-primary btn-sm"
                               th:href="@{/rechnungen/{id}/download(id=${inv.id})}">Download</a>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

</main>
</html>
